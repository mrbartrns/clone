<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Script</title>
</head>
<body>
    <style>
        textarea {
            font-family: 'Malgun Gothic';
        }
        
        button {
            border: none;
            background: none;
            outline: none;
            color: steelblue;
            border-radius: 0;
        }

        button:hover {
            background-color: steelblue;
            color: white;
        }
        .selected {
            background-color: steelblue;
            color: white;
        }

        .row {
            float: left;
        }
    </style>
    <h1>script</h1>
    <button type="button" class="button dialog mode selected" data-type="dialog">dialog</button>
    <button type="button" class="button sfx mode" data-type="sfx">sfx</button>
    <div class="container">
        <div class="row">
            <input type="checkbox" value="selected">
        </div>
        <form class="script-form">
            <textarea class="script" rows="30" cols="100" placeholder="'캐릭터이름: 대화' 양식을 꼭 지켜주세요."></textarea>
        </form>
    </div>
    <button type="button" class="script-submit">Submit</button>
    <div class="showing">
        <p></p>
    </div>
    <!--<script src="./script.js"></script>-->
    <script>
        // strings arr랑 objarr랑 갯수를 맞추기
        const scriptInput = document.querySelector(".script");
        const showing = document.querySelector(".showing");
        const showingP = showing.querySelector("p");
        const modes = document.querySelectorAll(".mode");
        const ENTER = 13;
        const SELECTED = "selected";
        
        let strings = [];
        let dialogObjects = [];
        // let types = [];

        function Dialog(action) {
            this.row = dialogObjects.length + 1;
            this.action = action;
            this.script = [];
        }

        Dialog.prototype.getRow = function() {
            return this.row;
        }

        Dialog.prototype.getAction = function() {
            return this.action;
        }

        Dialog.prototype.getScript = function() {
            return this.script;
        }

        Dialog.prototype.setAction = function(action) {
            this.action = action;
        }

        Dialog.prototype.setScript = function(text) {
            this.script.push(text);
        }

        function setUpMode() {
            modes[0].classList.remove(SELECTED);
            modes[1].classList.remove(SELECTED);
            this.classList.add(SELECTED);
            const action = document.querySelector(`.${SELECTED}`).dataset.type;
            // types[types.length - 1] = action;
            dialogObjects[dialogObjects.length - 1].setAction(action);
            console.log(dialogObjects);
        }

        modes.forEach( mode => {
            mode.addEventListener("click", setUpMode);
        });
        const action = document.querySelector(`.${SELECTED}`).dataset.type;
        const dialogObject = new Dialog(action);
        dialogObjects.push(dialogObject);
        // types.push(action);
        scriptInput.addEventListener("keypress", function(e) {
            if (e.keyCode === ENTER) {
                const action = document.querySelector(`.${SELECTED}`).dataset.type;
                const value = scriptInput.value;
                strings = value.split("\n");
                // types.push(action);
                strings.forEach((string, index) => {
                    dialogObjects[index].setScript(string);
                })
                const dialogObject = new Dialog(action);
                dialogObjects.push(dialogObject)
                console.log(dialogObjects)
                // if (strings.length < types.length) {
                //     console.log(strings);
                //     types = types.slice(0, strings.length);
                // }
                // console.log(strings);
                // console.log(types);
            }

        })
    </script>
</body>
</html>